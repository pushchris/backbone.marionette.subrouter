(function(factory){if(typeof define==="function"&&define.amd){define(["underscore","backbone","backbone.marionette"],factory)}else{factory(_,Backbone,Marionette)}})(function(_,Backbone,Marionette){Marionette.SubRouter=Marionette.AppRouter.extend({constructor:function(prefix,options){var routes={};this.prefix=prefix=prefix||"";this.separator=prefix.slice(-1)==="/"?"":"/";var createTrailingSlashRoutes=options&&options.createTrailingSlashRoutes;if(this.appRoutes){if(options&&options.controller){this.controller=options.controller}_.each(this.appRoutes,function(callback,path){if(path){if(path.substr(0)==="/"){path=path.substr(1,path.length)}routes[prefix+this.separator+path]=callback;if(createTrailingSlashRoutes){routes[prefix+this.separator+path+"/"]=callback}}else{routes[prefix]=callback;if(createTrailingSlashRoutes){routes[prefix+"/"]=callback}}},this);this.appRoutes=routes}Marionette.AppRouter.prototype.constructor.call(this,options);var hash;if(Backbone.history.fragment){hash=Backbone.history.getFragment()}else{hash=Backbone.history.getHash()}_.every(this.appRoutes,function(key,route){if(hash.match(Backbone.Router.prototype._routeToRegExp(route))){Backbone.history.loadUrl(hash);return false}return true},this)}});return Marionette.SubRouter});